from Utils.Results_variables import *
from Utils.Settings import Adapt_for_Nature_style
from Utils.Utils import Naturize_text

results = {"Transcriptomic overview of 5-HT receptors landscape":
               "We analysed the single-cell RNA-sequencing (scRNA-seq) dataset provided by Allen Institute {Yao, 2023 #2828} "
                "focusing on the expression of Htrs across 4 million cells. The scRNA-seq dataset contained informations about all the known "
                f"14 Htr. Prevalence of Htrs across the entire dataset was considerably different ranging from {expression_total.min()}% of {expression_total.idxmin()} "
               f"to {expression_total.max()}% of {expression_total.idxmax()} (Figure 1A). RNA of 6 Htr was found in less than 2.5% of the cells "
               f"({', '.join(expression_total[expression_total < 2.5].index.values)}). On the other hand, RNA of Htr1f, Htr2a and Htr2c was present in "
               f"at least 1 every 5 cells. Beside the amount of expression, also the distribution among classes was considerably different. This is exemplified"
               f"by looking at the distribution of the Htr1 and Htr2 families across different cluster groups (Figure 1B), groups were defined by location and neurotransmitter (Supplementary Figure #). We could see clear areas of overlap and "
               f"separation in cortical neurons, constituted by the Pallium-Glut and Subpallium-GABA groups. Distribution within family also showed considerable differences (Supplementary Figure #). "
               f"Htrs distribution was also markedly different across neurons "
               f"releasing different neurotransmitters (Figure 1C). Cells not found to express any transmitter made out {total_cells_by_neurotransmitter['']}% of the total (Supplementary Figure #). "
               f"This is the only group that did not express significant (mean prevalence = {round(expression_by_neurotransmitter.T[''].mean(),2)}±{round(expression_by_neurotransmitter.T[''].sem(),2)}%) amounts of any Htrs. All other groups expressed significant amounts of at least 2 different Htrs. "
               f"Expectedly the vast majority of cells is classified as excitatory ({total_cells_by_neurotransmitter['Glut']}%). "
               f"Around 1 every 5 cells was found to release GABA ({total_cells_by_neurotransmitter['GABA']}%). All the other neurotransmitter are found in less than 1% of the cells, "
               f"in particular, 5-HT releasing neurons  were found in only {total_cells_by_neurotransmitter['Sero']}% of the cells. 5-HT neurons expressed at high levels the highest variety of Htrs. They show "
               f"the highest prevalence for all the receptors belonging to the Htr1 family (Htr1a: {expression_by_neurotransmitter['Htr1a']['Sero']}%, "
               f"Htr1b: {expression_by_neurotransmitter['Htr1b']['Sero']}%, Htr1d: {expression_by_neurotransmitter['Htr1d']['Sero']}% and Htr1f: {expression_by_neurotransmitter['Htr1f']['Sero']}%). "
               f"They also show significant amounts (prevalence>20%) of Htr2c ({expression_by_neurotransmitter['Htr2c']['Sero']}%), "
               f"Htr5a ({expression_by_neurotransmitter['Htr5a']['Sero']}%), Htr5b ({expression_by_neurotransmitter['Htr5b']['Sero']}%) "
               f"and Htr7 ({expression_by_neurotransmitter['Htr7']['Sero']}%). In total, 5-HT neurons showed significant expression of 8 different Htrs. GABA-Glyc neurons, constituting only "
               f"{total_cells_by_neurotransmitter['GABA-Glyc']}% of cells, showed significant amounts of 7 different Htrs, with particularly high prevalence of Hr2c "
               f"({expression_by_neurotransmitter['Htr2c']['GABA-Glyc']}%), Htr7 ({expression_by_neurotransmitter['Htr7']['GABA-Glyc']}%), Htr1f ({expression_by_neurotransmitter['Htr1f']['GABA-Glyc']}%) and "
               f"Htr4 ({expression_by_neurotransmitter['Htr4']['GABA-Glyc']}%). Cells expressing GABA ({total_cells_by_neurotransmitter['GABA']}% of cells) show significant expression of "
               f"Htr2c ({expression_by_neurotransmitter['Htr2c']['GABA']}%), Htr1f ({expression_by_neurotransmitter['Htr1f']['GABA']}%), Htr4 ({expression_by_neurotransmitter['Htr4']['GABA']}%), Htr7 ({expression_by_neurotransmitter['Htr7']['GABA']}%) and "
               f"Htr2c ({expression_by_neurotransmitter['Htr2a']['GABA']}%). GABA-Glyc neurons showed a similar pattern with, notably, the higher prevalence of "
               f"Htr2a ({expression_by_neurotransmitter['Htr2a']['GABA-Glyc']}%) and Htr7 ({expression_by_neurotransmitter['Htr7']['GABA-Glyc']}%). Cholinergic neurons distinguished themself "
               f"by exhibiting the highest prevalence of Htr4 ({expression_by_neurotransmitter['Htr4']['Chol']}%) and Htr5b ({expression_by_neurotransmitter['Htr5b']['Chol']}%). "
               f"Glutamatergic neurons show significant expression of Htr1f ({expression_by_neurotransmitter['Htr1f']['Glut']}%), Htr2c ({expression_by_neurotransmitter['Htr2a']['Glut']}%) and "
               f"Htr2a ({expression_by_neurotransmitter['Htr2a']['Glut']}%). Dopaminergic neurons show a similar pattern with lower Htr2a ({expression_by_neurotransmitter['Htr7']['Dopa']}%) "
               f"and higher Htr7 ({expression_by_neurotransmitter['Htr7']['Dopa']}%). "
               f"At last, Histamine neurons express significant amounts of Htr2c ({expression_by_neurotransmitter['Htr2c']['Hist']}%) and Htr4 ({expression_by_neurotransmitter['Htr4']['Hist']}%), "
               f"Noradrenergic neurons instead show high prevalence of Htr1f ({expression_by_neurotransmitter['Htr1f']['Nora']}%) and Htr5a ({expression_by_neurotransmitter['Htr5a']['Nora']}%). Htr1f and Htr2c showed significant prevalence "
               f"across 8 out of 9 neurotransmitters groups (supplementary figure #)."
               f"Looking at expression across groups described in Figure 1B, we noticed that non-neuronal cells (NN-IMN-GC) showed the lowest expression, mirroring the data regarding cells without "
               f"any neurotransmitter. Interestingly the patterns of expression were less differentiated across groups "
               f"(Pearson coefficient={round(lower_triangle_groups.stack().mean(),2)}±{round(lower_triangle_groups.stack().sem(),2)}) compared to neurotransmitters "
               f"(Pearson coefficient={round(lower_triangle_neurotransmitter.stack().mean(),2)}±{round(lower_triangle_neurotransmitter.stack().sem(),2)}, Supplementary Figure #). "
               f"The totality of cells analyzed were divided in 34 classes following the original study. We analyzed expression across these  classes (Figure 1E). Average Pearson correlation between "
               f"patterns of expression was {round(lower_triangle_class.stack().mean(), 2)}±{round(lower_triangle_class.stack().sem(), 2)} (Figure 1F). Across classes, Htr2c was the one with the highest average prevalence "
               f"({mean_expression_by_class['Htr2c']}±{sem_expression_by_class['Htr2c']}%), followed by Htr1f ({mean_expression_by_class['Htr1f']}±{sem_expression_by_class['Htr1f']}%), "
               f"Htr7 ({mean_expression_by_class['Htr7']}±{sem_expression_by_class['Htr7']}%) and Htr4 ({mean_expression_by_class['Htr4']}±{sem_expression_by_class['Htr4']}%). "
               f"Correlation between Htrs expression across the totality of cells ranged from {lower_triangle_corr.min()} ({'-'.join(lower_triangle_corr.idxmin())}) to {lower_triangle_corr.max()} ({'-'.join(lower_triangle_corr.idxmax())}). "
               f"Considerable correlation was found also for the {'-'.join(lower_triangle_corr.index[1])} (Pearson coefficient={lower_triangle_corr.sort_values(ascending=False).iloc[1]}) and "
               f"{'-'.join(lower_triangle_corr.index[2])} (Pearson coefficient={lower_triangle_corr.sort_values(ascending=False).iloc[2]}) pairs (Figure 1H). Effect of this correlation was also visible "
               f"when looking at co-expression (Figure 1H). Expectedly, Htr1f and Htr2c, the most prevalent Htrs, were found to co-localize with other receptors respectevely {mean_coloc['Htr1f']}% "
               f"and  {mean_coloc['Htr2c']}% of the times. Only rarely a cell was found to express only one Htr, {round(at_least_2_receptors.mean().values[0], 2)}±{round(at_least_2_receptors.sem().values[0], 2)}% "
               f"of cells indeed expressed at least "
               f"2 Htrs (Figure 1G).Surprisingly, {round(at_least_5_receptors.mean().values[0], 2)}±{round(at_least_5_receptors.sem().values[0], 2)}% of cells expressed at least 5 Htrs. This is indicative of the complexity "
               f"of the 5-HT system even at a single cell level. The highest amount of co-localization (at least 2 Htrs) was present in the GABAergic neurons of midbrain, hindbrain, and cerebellum (MB-HB-Glut-Sero-Dopa, "
               f"{at_least_2_receptors_per_group.loc['MB-HB-Glut-Sero-Dopa']}%). The average, excluding non neuronal cells, was {round(at_least_2_receptors_per_group.drop('NN-IMN-GC').mean().values[0], 2)}±"
               f"{round(at_least_2_receptors_per_group.drop('NN-IMN-GC').sem().values[0], 2)}%. "
               f"The extensive expression across different classes and the considerable coexpression within cells point at the complexity of the 5-HT sistem. In the following sections we will take a deeper look "
               "each Htr family, taking advantage of the spatial information provided by the MERFISH dataset of {Zhang, 2023 #2887} regarding 9 Htrs. ",
           "Htr1 family": u"Receptors belonging to this family have an inhibitory effect on the host cell, they are coupled to G\u1D62 and cause a downstream decrease of cAMP "
                          "and activation of GIRK channels {Sharp, 2020 #2888}. Hr1a have a prevalence of around 10% in the brain, with a much lower presence in the TH-EPI-Glut and NN-IMN-GC groups (Figure 2A). "
                          "Expression aross classes was highly correlated between the RNA-seq and MERFISH datasets (Figure 2A), like in most of the other receptors. Highest expression was found in 5-HT neurons of the midbrain. "
                          "Htr1a co-localized most frequently with Htr1f, Htr2c and Htr2a (Figure 2C) and showed stable levels of co-localizations across groups like the majority of "
                          "other receptors (Supplementary Figure #). Looking at the spatial expression, the highest prevalence was found in cortical region of HPF, CTXsp and Isocortex. "
                          "Htr1b was more prevalent in the MB-HB-Glut-Sero-Dopa group reaching more than 30%. Prevalence in other groups, with the exception of NN-IMN-GC, was between 10 and 20% (Figure 3A). Looking at expression "
                          f"across classes, CNU-LGE GABA class showed the highest prevalence ({round(joined.groupby('class')['Htr1b'].apply(percentage_above_threshold).max(), 2)}%) in contrast with Htr1a that showed "
                          f"only minimal expression in this class ({round(joined.groupby('class')['Htr1a'].apply(percentage_above_threshold)['09 CNU-LGE GABA'], 2)}%). Prevalence > 20% was found also in a variety of other "
                          f"classes found in the hypothalamus (HY) and MB (Figure 3B). Co-localization showed a similar pattern compared to Htr1a (Figure 3C). Striatum showed by far the highest prevalence with "
                          f"{merfish_by_gene ['Htr1b']['STR']} (Figure 3D-E-F). Htr1d was expressed at a much lower level, never exceeding 8% prevalence (Figure 4A). it co-localizes at highest levels with "
                          f"Htr2c, Htr1f and Htr1b (Figure 4C). Similarly to Htr1b expression was highest in STR, "
                          f"reaching almost 10%. Interestingly, one cluster in the olfactory cortex (OLF), 0178 IT AON-TT-DP Glut, in the IT-ET Glut class exhibited high prevalence (>50%), visible on the left (black box) in Figure 4F. Average prevalence in the IT-ET Glut class was only "
                          f"{round(joined.groupby('class')['Htr1a'].apply(percentage_above_threshold)['01 IT-ET Glut'], 2)} %. Htr1f shows particularly strong expression in the RNA-seq dataset, however,"
                          f" the variability shared with the MERFISH dataset, in this case, is notably lower (Figure 5B, R²=0.52). Also the slope of the linear regression is "
                          f"significantly lower (0.23). Htr1f was found to co-localize the most with Htr2a and Htr2c (Figure 5C). Highest expression was observed in OLF, "
                          f"reaching over 20% consistently (Figure 5E-F).",
           "Htr2 family": "The Htr2 family is mainly linked to  Gq/11 and causes excitation by increasing intracellular Ca2+. Htr2a, famous for being instrumental in mediating the effects of psychedelics. is found "
                          "across the brain with highest prevalence in Pallium-Glut (Figure 6A). Considerable expression was found throghout the brain, with smaller amounts in TH-EPI-Glut and "
                          "NN-IMN-GC. Hy MM Glut CTX-MGE GABA and IT-ET Glut all had a prevalence of ≈40% (Figure 6B). Htr2a co-localized the most with Htr1f and Htr2c (Figure 6C). Isocortex and CTXsp "
                          "showed the highest prevalence, reaching more than 8% (Figure 6E-F). Some subclasses in IT-ET Glut exhibited a particularly high prevalence, 001 CLA-EPd-CTX Car3 Glut and "
                          "027 L6b EPd Glut both had a prevalence of more than 90%. Htr2b was found only in a minority of neurons and was not included in the MERFISH dataset. Interestigly, neurons belonging to "
                          f"the Pineal Glut class showed {round(joined.groupby('class')['Htr2b'].apply(percentage_above_threshold)['25 Pineal Glut'], 2)}% prevalence of Htr2b. Htr2c was the most "
                          f"prevalent receptor in the RNA-seq dataset, while the majority of the variability is shared with MERFISH, the slope of the linear regression is only 0.17 (Figure 8B). This indicates "
                          f"that,similarly to Htr1f,the MERFISH dataset did not detect such considerable expression. "
           }

if Adapt_for_Nature_style is True:
    results = Naturize_text(results)
#%%
